{"version":3,"file":"tiny-ga-events-helper.esm.dev.js","sources":["../src/tiny-ga-events-helper.js"],"sourcesContent":["/**\n * @typedef TinyGaEventsHelperOptions\n * @property {boolean?} debug\n */\n\n/**\n * @typedef TinyGaEventsHelperEvent\n * @property {string} el\n * @property {string} domEvent\n * @property {string} eventCategory\n * @property {string} eventAction\n * @property {(?string|?Function)} eventLabel\n * @property {(?string|?Function)} eventValue\n * @property {Map<Element,Function>} handlers\n */\n\n/**\n * @typedef TinyGaEventsHelper\n * @property {TinyGaEventsHelperOptions} options\n * @property {TinyGaEventsHelperEvent[]} events;\n */\n\n/** @type {string[]} */\nconst mandatoryKeys = ['domEvent', 'el', 'eventCategory', 'eventAction']\n\n/** @type {string[]} */\nconst availableKeysForEvent = [\n  'eventCategory',\n  'eventAction',\n  'eventLabel',\n  'eventValue',\n]\n\n/**\n * @type {TinyGaEventsHelper}\n */\nexport default class TinyGaEventsHelper {\n  /**\n   * @param {TinyGaEventsHelperEvent[]} events\n   * @param {TinyGaEventsHelperOptions} options\n   * @throws\n   * @constructor\n   */\n  constructor(events, options = { debug: false }) {\n    if (!ga) throw 'Google Analytics not included or blocked by the browser.'\n\n    this.events = events\n    this.options = options\n\n    /* istanbul ignore if  */\n    if (this.options.debug) {\n      console.group('Received events: ')\n      console.log(this.events)\n      console.groupEnd()\n    }\n\n    if (TinyGaEventsHelper.isValidConfig(this.events)) {\n      this.addEvents(this.events)\n    } else {\n      throw 'Invalid configuration exception.'\n    }\n  }\n\n  /**\n   * Adds a single event to Google Analytics\n   * @param {TinyGaEventsHelperEvent} event\n   */\n  addEvent(event) {\n    const self = this\n    let elements = document.querySelectorAll(event.el)\n    for (let i = 0; i < elements.length; i++) {\n      const element = elements[i]\n      const handler = function () {\n        ga &&\n          ga(\n            'send',\n            Object.assign(\n              { hitType: 'event' },\n              TinyGaEventsHelper.extractValuesFromEvent(\n                event,\n                this,\n                self.options.debug\n              )\n            )\n          )\n      }\n      element.addEventListener(event.domEvent, handler)\n      event.handlers = event.handlers || new Map()\n      event.handlers.set(element, handler)\n    }\n  }\n\n  /**\n   * Adds a collection of events\n   * @param {TinyGaEventsHelperEvent[]} events\n   */\n  addEvents(events = []) {\n    events.length > 0 && events.map(this.addEvent.bind(this))\n  }\n\n  /**\n   * Validates the instance config\n   * @param {TinyGaEventsHelperEvent[]}\n   * @return {boolean}\n   * @throws\n   * @static\n   */\n  static isValidConfig(events) {\n    if (!Array.isArray(events) || events.length === 0) return false\n\n    for (let i = 0; i < events.length; i++) {\n      let currentEvent = events[i]\n      for (let j = 0; j < mandatoryKeys.length; j++) {\n        let currentMandatoryKey = mandatoryKeys[j]\n        if (\n          !currentEvent.hasOwnProperty(currentMandatoryKey) ||\n          currentEvent[currentMandatoryKey] === null\n        ) {\n          console.warn(\n            `The configuration at position \"${j}\" doesn't have the mandatory key \"${currentMandatoryKey}\" or it's null.`\n          )\n          return false\n        }\n      }\n    }\n\n    return true\n  }\n\n  /**\n   * @param {TinyGaEventsHelperEvent} event\n   * @param {HTMLElement} el\n   * @param {?boolean} [showDebugInfo=false]\n   * @static\n   * @return {{}}\n   */\n  static extractValuesFromEvent(event, el, showDebugInfo = false) {\n    let keys = Object.keys(event)\n    let values = {}\n    showDebugInfo && console.group(`Extracting values from event:`)\n    for (let i = 0; i < keys.length; i++) {\n      let key = keys[i]\n      if (!availableKeysForEvent.includes(key)) {\n        showDebugInfo && console.log(`Invalid key for GA event:\"' + key + '\".`)\n        continue\n      }\n\n      let value = event[key]\n      if (typeof value === 'function') {\n        showDebugInfo &&\n          console.info(`Return type of the event key \"${key}\" is a function.`)\n        values[key] = value.apply(el)\n      } else {\n        showDebugInfo &&\n          console.info(\n            `Return type of the event key \"${key}\" is a literal \"${value}\".`\n          )\n        values[key] = value\n      }\n    }\n\n    /* istanbul ignore if  */\n    if (showDebugInfo) {\n      console.group('Values:')\n      console.log(values)\n      console.groupEnd()\n      console.groupEnd()\n    }\n    return values\n  }\n\n  /**\n   * Removes all the configured event listeners\n   */\n  destroy() {\n    for (let i = 0; i < this.events.length; i++) {\n      /** @type {TinyGaEventsHelperEvent} */\n      const event = this.events[i]\n      const elements = document.querySelectorAll(event.el)\n      for (let j = 0; j < elements.length; j++) {\n        /** @type {Element} */\n        const el = elements[j]\n        el.removeEventListener(event.domEvent, event.handlers.get(el))\n        event.handlers.delete(el)\n      }\n    }\n  }\n}\n"],"names":["mandatoryKeys","availableKeysForEvent","TinyGaEventsHelper","events","options","debug","ga","console","group","log","groupEnd","isValidConfig","addEvents","event","self","elements","document","querySelectorAll","el","i","length","element","handler","Object","assign","hitType","extractValuesFromEvent","addEventListener","domEvent","handlers","Map","set","map","addEvent","bind","j","removeEventListener","get","Array","isArray","currentEvent","currentMandatoryKey","hasOwnProperty","warn","showDebugInfo","keys","values","key","includes","value","info","apply"],"mappings":"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"}